!function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=function(){function e(){s(this,e);window.location;this.app="default",this.room="default",this.connectedClients=[],this.roomOccupantListener=null,this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}return i(e,[{key:"setServerUrl",value:function(e){this.wsUrl=e}},{key:"setApp",value:function(e){this.app=e}},{key:"setRoom",value:function(e){this.room=e}},{key:"setWebRtcOptions",value:function(e){}},{key:"setServerConnectListeners",value:function(e,t){this.connectSuccess=e,this.connectFailure=t}},{key:"setRoomOccupantListener",value:function(e){this.roomOccupantListener=e}},{key:"setDataChannelListeners",value:function(e,t,n){this.openListener=e,this.closedListener=t,this.messageListener=n}},{key:"updateTimeOffset",value:function(){var e=this,t=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then(function(n){var s=new Date(n.headers.get("Date")).getTime()+500,i=Date.now(),o=s+(i-t)/2,a=o-i;e.serverTimeRequests++,e.serverTimeRequests<=10?e.timeOffsets.push(a):e.timeOffsets[e.serverTimeRequests%10]=a,e.avgTimeOffset=e.timeOffsets.reduce(function(e,t){return e+=t},0)/e.timeOffsets.length,e.serverTimeRequests>10?setTimeout(function(){return e.updateTimeOffset()},3e5):e.updateTimeOffset()})}},{key:"connect",value:function(){this.wsUrl&&"/"!==this.wsUrl||("https:"===location.protocol?this.wsUrl="wss://"+location.host:this.wsUrl="ws://"+location.host),this.updateTimeOffset();var e=new WebSocket(this.wsUrl),t=this;e.addEventListener("open",function(e){t.sendJoinRoom()}),e.addEventListener("error",function(e){t.connectFailure()}),e.addEventListener("message",function(e){var n=JSON.parse(e.data);if("roomOccupantsChange"===n.type)t.receivedOccupants(n.data.occupants);else if("connectSuccess"===n.type){var s=n.data,i=s.id;t.connectSuccess(i)}else if("send"==n.type||"broadcast"==n.type){var o=n.from,a=n.data,r=a.type,s=a.data;t.messageListener(o,r,s)}}),this.socket=e}},{key:"sendJoinRoom",value:function(){this._send("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(e){for(var t={},n=0;n<e.length;n++)e[n]!=NAF.clientId&&(t[e[n]]=!0);this.roomOccupantListener(t)}},{key:"shouldStartConnectionTo",value:function(e){return!0}},{key:"startStreamConnection",value:function(e){this.connectedClients.push(e),this.openListener(e)}},{key:"closeStreamConnection",value:function(e){var t=this.connectedClients.indexOf(e);t>-1&&this.connectedClients.splice(t,1),this.closedListener(e)}},{key:"getConnectStatus",value:function(e){return-1!=this.connectedClients.indexOf(e)?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}},{key:"sendData",value:function(e,t,n){var s={target:e,type:t,data:n};this._send("send",s)}},{key:"sendDataGuaranteed",value:function(e,t,n){this.sendData(e,t,n)}},{key:"broadcastData",value:function(e,t){var n={type:e,data:t};this._send("broadcast",n)}},{key:"broadcastDataGuaranteed",value:function(e,t){this.broadcastData(e,t)}},{key:"getServerTime",value:function(){return Date.now()+this.avgTimeOffset}},{key:"disconnect",value:function(){this.socket.close()}},{key:"_send",value:function(e,t){var n={from:NAF.clientId,type:e,data:t},s=JSON.stringify(n);this.socket.send(s)}}]),e}();NAF.adapters.register("uws",o),e.exports=o}]);
//# sourceMappingURL=naf-uws-adapter.min.js.map